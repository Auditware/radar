version: 0.1.0
author: avigaildanesh
name: Missing Transfer Amount Validation
severity: Low
certainty: Low
description: Ensure that token transfers validate the amount being transferred. Transfers should not allow negative values or amounts exceeding the account balance.
rule: |
  for source, nodes in ast:
      try:
          transfer_calls = nodes.find_chained_calls("token", "transfer").exit_on_none()
          for call in transfer_calls:
              amount_checked = nodes.find_comparisons("amount", call.first().access_path).exit_on_value()
              if not amount_checked:
                  print(call.first().to_result())
      except:
          continue
