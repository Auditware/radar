name: Unauthorized State Modification
description: Functions that modify critical state variables without proper access control checks allow any user to manipulate contract state, leading to unauthorized changes and potential exploitation.
severity: High
certainty: Medium
vulnerable_example: https://github.com/Auditware/radar/blob/main/api/tests/mocks/unauthorized_state_modification/bad/lib.rs#L13-L15
rule: |
  for source, nodes in ast:
    try:
      funcs = nodes.find_all_functions().exit_on_none()
      for func in funcs:
        access_path = func.access_path or ""
        if ".impl." not in access_path:
          continue
        
        has_address_param = func.find_by_names("Address")
        if not has_address_param.nodes:
          continue
        
        modifies_mapping = func.find_by_names("setter", "set")
        if not modifies_mapping.nodes:
          continue
        
        has_msg_sender = func.find_by_names("msg", "sender")
        has_require = func.find_by_names("require", "assert", "ensure")
        
        if not has_msg_sender.nodes and not has_require.nodes:
          body_nodes = func.find_by_names("setter", "set", "get")
          if body_nodes.nodes:
            func_ident = func.find_by_names(func.ident).exit_on_none()
            print(func_ident.first().to_result())
    except:
      continue
