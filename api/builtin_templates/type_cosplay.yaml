version: 0.1.0
author: forefy
accent: anchor
name: Type Cosplay
description: Type cosplay vulnerability occurs when a program fails to validate that an account is of the expected type, allowing malicious accounts to masquerade as legitimate program accounts.
severity: Low
certainty: Low
vulnerable_example: https://github.com/Auditware/radar/blob/main/api/tests/mocks/type_cosplay/bad/lib.rs#L12-L14
rule: |
  for source, nodes in ast:
      try:
          funcs = nodes.find_all_functions().exit_on_none()
          for func in funcs:
              has_borrow = func.find_by_names("try_borrow_data", "try_borrow_mut_data", "borrow_data", "borrow_mut_data")
              if not has_borrow.nodes:
                  continue
              
              has_validation = func.find_functions_by_names("try_from", "try_from_slice", "try_into")
              if has_validation.nodes:
                  continue
              
              print(has_borrow.first().to_result())
      except:
          continue