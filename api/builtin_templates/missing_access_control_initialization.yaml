version: 0.1.0
author: radar
name: Missing Access Control on Initialization
description: Initialization functions should verify that only authorized addresses can call them to prevent unauthorized configuration. Note - May report sol_interface declarations; check impl blocks for actual vulnerabilities.
severity: High
certainty: High
rule: |
  for source, nodes in ast:
    try:
      if "erc721.rs" in source or "erc20.rs" in source:
        continue
      funcs = nodes.find_all_functions().exit_on_none()
      for func in funcs:
        if func.ident in ["initialize", "init", "setup"]:
          access_path = func.access_path or ""
          if ".impl." not in access_path:
            continue
          
          has_self = func.find_by_names("self")
          if not has_self.nodes:
            continue
          
          has_address_param = func.find_by_names("Address")
          if not has_address_param.nodes:
            continue
          
          modifies_state = func.find_by_names("set")
          if not modifies_state.nodes:
            continue
          
          has_msg = func.find_by_names("msg")
          has_sender = func.find_by_names("sender")
          has_require = func.find_by_names("require", "assert", "ensure")
          
          checks_msg_sender = has_msg.nodes and has_sender.nodes
          
          if not checks_msg_sender and not has_require.nodes:
            func_ident = func.find_by_names(func.ident).exit_on_none().first()
            if func_ident.parent and func_ident.parent.metadata:
              print(func_ident.parent.to_result())
            else:
              print(func_ident.to_result())
    except:
      continue
