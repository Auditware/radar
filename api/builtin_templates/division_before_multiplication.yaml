version: 0.1.0
author: avigaildanesh
name: Division Before Multiplication
description: Performing division before multiplication causes precision loss due to truncation, leading to incorrect calculations in financial operations.
severity: Medium
certainty: Medium
vulnerable_example: https://github.com/Auditware/radar/blob/main/api/tests/mocks/division_before_multiplication/bad/src/lib.rs#L13
rule: |
  for source, nodes in ast:
      try:
          div_nodes = nodes.find_by_access_path("binary.left.binary.right.lit")
          for div_node in div_nodes:
              parent = div_node.parent
              if not parent:
                  continue
              lit_in_left = "binary.left.binary.right.lit" in div_node.access_path
              has_field_right = False
              has_field_left = False
              for c in parent.children:
                  if "binary.right.field" in c.access_path:
                      has_field_right = True
                  if "binary.left.field" in c.access_path:
                      has_field_left = True
              if has_field_left and not lit_in_left:
                  continue
              if lit_in_left and has_field_right and not has_field_left:
                  print(div_node.to_result())
      except:
          continue
