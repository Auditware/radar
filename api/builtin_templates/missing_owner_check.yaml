version: 0.1.0
author: forefy
accent: anchor
name: Missing Owner Check
description: The Account struct includes an owner field indicating the key associated with that account's owner. This field should be used to ensure a caller of an owner-only intended functionality, is in fact the owner.
severity: Low
certainty: Low
vulnerable_example: https://github.com/Auditware/radar/blob/main/api/tests/mocks/missing_owner_check/bad/src/lib.rs#L13
rule: |
  for source, nodes in ast:
      try:
          derive_account_nodes = nodes.find_chained_calls("derive", "Accounts").exit_on_none()
          if nodes.find_by_names("SplTokenAccount"):
              nodes.find_by_names("require", "require_eq", "require_keys_eq").exit_on_value()
              nodes.find_comparison_involving("owner").exit_on_value()
          elif nodes.find_comparison_involving("owner") or nodes.find_member_accesses("owner"):
              continue
          print(derive_account_nodes.first().first().to_result())
      except:
          continue