version: 0.1.0
author: forefy
accent: stylus
name: Exponential Calculation Complexity
description: Nested iterations with multiplication operations can cause exponential gas costs and DoS vulnerabilities.
severity: Medium
certainty: Low
vulnerable_example: https://github.com/Auditware/radar/blob/main/api/tests/mocks/exponential_calculation_complexity/bad/lib.rs#L13-L18
rule: |
  for source, nodes in ast:
    try:
      funcs = nodes.find_all_functions().exit_on_none()
      for func in funcs:
        access_path = func.access_path or ""
        if ".impl." not in access_path:
          continue
        
        has_iter = func.find_by_names("iter", "into_iter")
        if not has_iter.nodes:
          continue
        
        has_mul = func.find_binary_operations("*")
        if not has_mul:
          continue
        
        iter_count = len([n for n in has_iter.nodes if n])
        if iter_count >= 2:
          func_ident = func.find_by_names(func.ident).exit_on_none().first()
          if func_ident.parent and func_ident.parent.metadata:
            print(func_ident.parent.to_result())
          else:
            print(func_ident.to_result())
    except:
      continue
